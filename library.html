<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learn Directory - ShotClock</title>
  <meta name="description" content="Browse dedicated ShotClock guides for peptides, medications, vitamins, and minerals with external citations and tracking-focused context.">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a class="nav-brand" href="index.html" aria-label="ShotClock home">
        <span class="nav-brand-mark">SC</span>
        <span class="nav-brand-text">ShotClock</span>
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="library.html" class="active">Learn</a>
        <a href="updates.html">Updates</a>
        <a href="support.html">Support</a>
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
      </div>
    </div>
  </nav>

  <main class="library-content">
    <div class="container">
      <h1>Guide Directory: Peptides, Medications, Vitamins, and Minerals</h1>
      <p class="support-intro">
        Find dedicated pages for each compound, then move into ShotClock with a cleaner tracking plan.
        Every guide includes dosing context, safety framing, provider questions, and a source list.
      </p>

      <section class="directory-controls" aria-label="Guide search and filter controls">
        <label for="guide-search" class="directory-label">Search guides</label>
        <input id="guide-search" class="guide-search" type="search" placeholder="Search by name, alias, or category (e.g., semaglutide, peptide, magnesium)">

        <div class="filter-row" role="group" aria-label="Guide filters">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="medications">Medications</button>
          <button class="filter-btn" data-filter="peptides">Peptides</button>
          <button class="filter-btn" data-filter="support">Support</button>
          <button class="filter-btn" data-filter="minerals">Minerals</button>
          <button class="filter-btn" data-filter="experimental">Experimental</button>
        </div>

        <p class="directory-meta" id="directory-meta">Loading guide directory...</p>
      </section>

      <section class="directory-grid" id="guide-grid" aria-live="polite"></section>

      <section class="guide-section latest-updates-module">
        <div class="module-head">
          <h2>Latest updates</h2>
          <a href="updates.html" class="btn btn-outline module-link">Open full update feed</a>
        </div>
        <div id="latest-updates" class="updates-preview-grid"></div>
      </section>

      <section class="guide-section compliance-box">
        <h2>How to use this directory</h2>
        <p>Use these pages to prepare cleaner questions and better logs, not to self-prescribe.</p>
        <p>For severe symptoms or emergencies in the United States, call 911 and contact your clinician immediately.</p>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <section class="footer-section">
          <h4>Product</h4>
          <ul>
            <li><a href="index.html#features">Why ShotClock</a></li>
            <li><a href="support.html">Support</a></li>
            <li><a href="index.html#download">Get App Access</a></li>
          </ul>
        </section>

        <section class="footer-section">
          <h4>Learn</h4>
          <ul>
            <li><a href="library.html">Guide Directory</a></li>
            <li><a href="updates.html">Guide Updates</a></li>
            <li><a href="guides/semaglutide.html">Semaglutide Guide</a></li>
          </ul>
        </section>

        <section class="footer-section">
          <h4>Legal</h4>
          <ul>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="terms.html">Terms of Service</a></li>
            <li><a href="mailto:legal@trackglp1.com">Legal Contact</a></li>
          </ul>
        </section>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2026 ShotClock. All rights reserved.</p>
        <p class="disclaimer">Educational content only. Always consult a licensed healthcare professional.</p>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      const searchInput = document.getElementById('guide-search');
      const filterButtons = Array.from(document.querySelectorAll('.filter-btn'));
      const grid = document.getElementById('guide-grid');
      const meta = document.getElementById('directory-meta');
      const updatesGrid = document.getElementById('latest-updates');

      let guides = [];
      let currentFilter = 'all';
      let currentQuery = '';

      const normalize = (value) => String(value || '').toLowerCase();

      const resolveGroup = (guide) => {
        const category = normalize(guide.category);
        const status = normalize(guide.status);

        if (category.includes('mineral')) return 'minerals';
        if (status.includes('experimental') || status.includes('discontinued') || status.includes('regional')) return 'experimental';
        if (category.includes('glp-1') || category.includes('gip') || category.includes('insulin') || category.includes('metformin')) return 'medications';
        if (category.includes('peptide') || category.includes('gh secretagogue') || category.includes('nootropic') || category.includes('anti-aging') || category.includes('healing')) return 'peptides';
        return 'support';
      };

      const statusClass = (status) => {
        const value = normalize(status);
        if (value.includes('approved')) return 'status-approved';
        if (value.includes('experimental')) return 'status-experimental';
        if (value.includes('discontinued')) return 'status-discontinued';
        if (value.includes('regional')) return 'status-regional';
        if (value.includes('nutrient')) return 'status-nutrient';
        return 'status-support';
      };

      const renderGuides = () => {
        const filtered = guides.filter((guide) => {
          const haystack = [guide.slug, guide.title, guide.category, guide.status, ...(guide.aliases || [])]
            .join(' ')
            .toLowerCase();

          const matchesQuery = currentQuery.length === 0 || haystack.includes(currentQuery);
          const matchesFilter = currentFilter === 'all' || resolveGroup(guide) === currentFilter;

          return matchesQuery && matchesFilter;
        });

        meta.textContent = `${filtered.length} guides shown out of ${guides.length}.`;

        if (filtered.length === 0) {
          grid.innerHTML = '<article class="directory-card"><h3>No guides match</h3><p>Try a broader search term or switch to the All filter.</p></article>';
          return;
        }

        grid.innerHTML = filtered
          .map((guide) => {
            const aliases = (guide.aliases || []).slice(0, 3).join(', ');
            return `
              <article class="directory-card">
                <div class="directory-card-head">
                  <span class="status-badge ${statusClass(guide.status)}">${guide.statusLabel || guide.status}</span>
                  <span class="status-badge status-category">${guide.category}</span>
                </div>
                <h3><a href="guides/${guide.slug}.html">${guide.title}</a></h3>
                <p>${guide.heroSummary}</p>
                <p class="guide-aliases">Aliases: ${aliases || 'No common aliases listed'}</p>
                <div class="directory-card-actions">
                  <a class="btn btn-outline" href="guides/${guide.slug}.html">Open guide</a>
                </div>
              </article>
            `;
          })
          .join('');
      };

      const renderUpdates = (updates) => {
        const sorted = updates.slice().sort((a, b) => b.date.localeCompare(a.date)).slice(0, 3);

        updatesGrid.innerHTML = sorted
          .map((item) => {
            const links = (item.impactedGuides || [])
              .slice(0, 4)
              .map((slug) => `<a href="guides/${slug}.html" class="update-link">${slug}</a>`)
              .join(' ');

            return `
              <article class="update-card compact">
                <div class="update-head">
                  <p class="update-date">${item.date}</p>
                  <span class="status-badge status-category">v${item.version}</span>
                </div>
                <h3>${item.title}</h3>
                <p>${item.summary}</p>
                <p class="update-links-inline">${links}</p>
              </article>
            `;
          })
          .join('');
      };

      const setFilter = (filter) => {
        currentFilter = filter;
        filterButtons.forEach((button) => {
          button.classList.toggle('active', button.dataset.filter === filter);
        });
        renderGuides();
      };

      searchInput.addEventListener('input', (event) => {
        currentQuery = normalize(event.target.value.trim());
        renderGuides();
      });

      filterButtons.forEach((button) => {
        button.addEventListener('click', () => setFilter(button.dataset.filter));
      });

      Promise.all([
        fetch('content/guides.json', { cache: 'no-store' }).then((res) => res.json()),
        fetch('content/updates.json', { cache: 'no-store' }).then((res) => res.json())
      ])
        .then(([guideData, updateData]) => {
          guides = guideData.slice().sort((a, b) => a.title.localeCompare(b.title));
          renderGuides();
          renderUpdates(updateData);
        })
        .catch((error) => {
          console.error(error);
          meta.textContent = 'Unable to load guide data. Please refresh or contact support.';
          grid.innerHTML = '<article class="directory-card"><h3>Directory unavailable</h3><p>Guide data could not be loaded right now.</p></article>';
          updatesGrid.innerHTML = '<article class="update-card compact"><h3>Updates unavailable</h3><p>Try again shortly.</p></article>';
        });
    }());
  </script>
</body>
</html>
