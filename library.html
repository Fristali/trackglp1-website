<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learn Directory - ShotClock</title>
  <meta name="description" content="Browse dedicated ShotClock guides for peptides, medications, vitamins, and minerals with external citations and tracking-focused context.">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a class="nav-brand" href="index.html" aria-label="ShotClock home">
        <span class="nav-brand-mark">SC</span>
        <span class="nav-brand-text">ShotClock</span>
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="library.html" class="active">Learn</a>
        <a href="support.html">Support</a>
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
      </div>
    </div>
  </nav>

  <main class="library-content">
    <div class="container">
      <h1>Guide Directory: Peptides, Medications, Vitamins, and Minerals</h1>
      <p class="support-intro">
        Find dedicated pages for each compound, then move into ShotClock with a cleaner tracking plan.
        Every guide includes dosing context, safety framing, provider questions, and a source list.
      </p>

      <section class="directory-controls" aria-label="Guide search and filter controls">
        <label for="guide-search" class="directory-label">Search guides</label>
        <input id="guide-search" class="guide-search" type="search" placeholder="Search by name, alias, class, or status">

        <div class="facet-grid" aria-label="Multi-facet guide filters">
          <fieldset class="facet-group">
            <legend class="facet-label">Class</legend>
            <div class="facet-chips">
              <button type="button" class="facet-chip" data-facet="class" data-value="peptide">Peptide</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="glp-1-gip">GLP-1/GIP</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="hormone">Hormone</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="injectable-compound">Injectable Compound</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="oral-compound">Oral Compound</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="vitamin">Vitamin</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="mineral">Mineral</button>
              <button type="button" class="facet-chip" data-facet="class" data-value="supportive">Supportive</button>
            </div>
          </fieldset>

          <fieldset class="facet-group">
            <legend class="facet-label">Status</legend>
            <div class="facet-chips">
              <button type="button" class="facet-chip" data-facet="status" data-value="approved">Approved</button>
              <button type="button" class="facet-chip" data-facet="status" data-value="experimental">Experimental</button>
              <button type="button" class="facet-chip" data-facet="status" data-value="regional-approval">Regional Approval</button>
              <button type="button" class="facet-chip" data-facet="status" data-value="discontinued">Discontinued</button>
              <button type="button" class="facet-chip" data-facet="status" data-value="support-nutrient">Support/Nutrient</button>
            </div>
          </fieldset>

          <fieldset class="facet-group">
            <legend class="facet-label">Route</legend>
            <div class="facet-chips">
              <button type="button" class="facet-chip" data-facet="route" data-value="injectable">Injectable</button>
              <button type="button" class="facet-chip" data-facet="route" data-value="oral">Oral</button>
              <button type="button" class="facet-chip" data-facet="route" data-value="mixed-unknown">Mixed/Unknown</button>
            </div>
          </fieldset>

          <fieldset class="facet-group">
            <legend class="facet-label">Format</legend>
            <div class="facet-chips">
              <button type="button" class="facet-chip" data-facet="format" data-value="single-compound">Single Compound</button>
              <button type="button" class="facet-chip" data-facet="format" data-value="blend">Blend</button>
            </div>
          </fieldset>
        </div>

        <div class="directory-meta-row">
          <p class="directory-meta" id="directory-meta">Loading guide directory...</p>
          <button type="button" class="btn btn-outline btn-small" id="clear-filters">Clear filters</button>
        </div>

        <div id="active-filters" class="active-filters" aria-live="polite"></div>
      </section>

      <section class="directory-grid" id="guide-grid" aria-live="polite"></section>

      <section class="guide-section compliance-box">
        <h2>How to use this directory</h2>
        <p>Use these pages to prepare cleaner questions and better logs, not to self-prescribe.</p>
        <p>For severe symptoms or emergencies in the United States, call 911 and contact your clinician immediately.</p>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <section class="footer-section">
          <h4>Product</h4>
          <ul>
            <li><a href="index.html#features">Why ShotClock</a></li>
            <li><a href="support.html">Support</a></li>
            <li><a href="index.html#download">Get App Access</a></li>
          </ul>
        </section>

        <section class="footer-section">
          <h4>Learn</h4>
          <ul>
            <li><a href="library.html">Guide Directory</a></li>
            <li><a href="guides/semaglutide.html">Semaglutide Guide</a></li>
          </ul>
        </section>

        <section class="footer-section">
          <h4>Legal</h4>
          <ul>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="terms.html">Terms of Service</a></li>
            <li><a href="mailto:legal@trackglp1.com">Legal Contact</a></li>
          </ul>
        </section>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2026 ShotClock. All rights reserved.</p>
        <p class="disclaimer">Educational content only. Always consult a licensed healthcare professional.</p>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      const searchInput = document.getElementById('guide-search');
      const grid = document.getElementById('guide-grid');
      const meta = document.getElementById('directory-meta');
      const activeFiltersEl = document.getElementById('active-filters');
      const clearFiltersButton = document.getElementById('clear-filters');
      const facetChips = Array.from(document.querySelectorAll('.facet-chip'));

      const state = {
        q: '',
        selected: {
          class: new Set(),
          status: new Set(),
          route: new Set(),
          format: new Set()
        }
      };
      const defaultPeptideSeed = { active: false };

      let guides = [];

      const FACET_KEYS = ['class', 'status', 'route', 'format'];

      const slugify = (value) => String(value || '')
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');

      const normalize = (value) => String(value || '').toLowerCase().trim();

      const escapeHtml = (value) => String(value || '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');

      const statusClass = (status) => {
        const value = normalize(status);
        if (value.includes('approved')) return 'status-approved';
        if (value.includes('experimental')) return 'status-experimental';
        if (value.includes('discontinued')) return 'status-discontinued';
        if (value.includes('regional')) return 'status-regional';
        if (value.includes('nutrient')) return 'status-nutrient';
        return 'status-support';
      };

      const hasParams = (params) => FACET_KEYS.some((key) => params.has(key)) || params.has('q');

      const restoreStateFromUrl = () => {
        const params = new URLSearchParams(window.location.search);

        if (!hasParams(params)) {
          state.selected.class.add('peptide');
          defaultPeptideSeed.active = true;
          return;
        }

        defaultPeptideSeed.active = false;
        state.q = normalize(params.get('q') || '');

        FACET_KEYS.forEach((facet) => {
          const raw = params.get(facet);
          if (!raw) return;
          raw.split(',').map((item) => normalize(item)).filter(Boolean).forEach((item) => state.selected[facet].add(item));
        });
      };

      const syncUrl = () => {
        const params = new URLSearchParams();

        if (state.q) params.set('q', state.q);

        FACET_KEYS.forEach((facet) => {
          const values = Array.from(state.selected[facet]).sort();
          if (values.length > 0) {
            params.set(facet, values.join(','));
          }
        });

        const query = params.toString();
        const nextUrl = query ? `library.html?${query}` : 'library.html';
        window.history.replaceState({}, '', nextUrl);
      };

      const releaseDefaultPeptideSeed = (facet, value) => {
        if (!defaultPeptideSeed.active) return;

        const onlyDefaultPeptide = state.selected.class.size === 1
          && state.selected.class.has('peptide')
          && state.selected.status.size === 0
          && state.selected.route.size === 0
          && state.selected.format.size === 0
          && !state.q;

        if (!onlyDefaultPeptide) {
          defaultPeptideSeed.active = false;
          return;
        }

        if (facet === 'class' && value === 'peptide') {
          return;
        }

        state.selected.class.clear();
        defaultPeptideSeed.active = false;
      };

      const facetMatch = (guideFacetValues, selectedValues) => {
        if (selectedValues.size === 0) return true;
        const normalizedValues = (guideFacetValues || []).map((value) => slugify(value));
        return Array.from(selectedValues).some((value) => normalizedValues.includes(value));
      };

      const buildSearchIndex = (guide) => [
        guide.slug,
        guide.title,
        guide.displayTitle,
        guide.subtitle,
        guide.category,
        guide.status,
        ...(guide.aliases || []),
        ...(guide.taxonomy?.classTags || []),
        ...(guide.taxonomy?.statusTags || []),
        ...(guide.taxonomy?.routeTags || []),
        ...(guide.taxonomy?.formatTags || [])
      ].join(' ').toLowerCase();

      const renderActiveFilters = () => {
        const chips = [];

        if (state.q) {
          chips.push(`<button class="active-filter-chip" data-remove="q">Search: ${escapeHtml(state.q)}</button>`);
        }

        FACET_KEYS.forEach((facet) => {
          Array.from(state.selected[facet]).forEach((value) => {
            const label = value.replace(/-/g, ' ');
            chips.push(`<button class="active-filter-chip" data-remove="${facet}" data-value="${escapeHtml(value)}">${escapeHtml(label)}</button>`);
          });
        });

        activeFiltersEl.innerHTML = chips.length > 0
          ? chips.join('')
          : '<p class="active-filters-empty">Peptides-first is active by default when no URL filters are present.</p>';
      };

      const renderGuides = () => {
        const filtered = guides.filter((guide) => {
          const matchesQuery = !state.q || guide.searchIndex.includes(state.q);

          if (!matchesQuery) return false;

          const taxonomy = guide.taxonomy || {};

          const matchesClass = facetMatch(taxonomy.classTags, state.selected.class);
          const matchesStatus = facetMatch(taxonomy.statusTags, state.selected.status);
          const matchesRoute = facetMatch(taxonomy.routeTags, state.selected.route);
          const matchesFormat = facetMatch(taxonomy.formatTags, state.selected.format);

          return matchesClass && matchesStatus && matchesRoute && matchesFormat;
        });

        meta.textContent = `${filtered.length} guides shown out of ${guides.length}.`;

        if (filtered.length === 0) {
          grid.innerHTML = '<article class="directory-card"><h3>No guides match these filters</h3><p>Try removing one facet or broadening the search query.</p></article>';
          return;
        }

        grid.innerHTML = filtered.map((guide) => {
          const aliases = (guide.aliases || []).slice(0, 3).join(', ');
          const tags = [
            ...(guide.taxonomy?.classTags || []),
            ...(guide.taxonomy?.statusTags || []),
            ...(guide.taxonomy?.routeTags || []),
            ...(guide.taxonomy?.formatTags || [])
          ];

          return `
            <article class="directory-card">
              <div class="directory-card-head">
                <span class="status-badge ${statusClass(guide.status)}">${escapeHtml(guide.statusLabel || guide.status)}</span>
                <span class="status-badge status-category">${escapeHtml(guide.category)}</span>
              </div>
              <h3><a href="guides/${escapeHtml(guide.slug)}.html">${escapeHtml(guide.displayTitle || guide.title)}</a></h3>
              <p class="directory-subtitle">${escapeHtml(guide.subtitle || guide.heroSummary || '')}</p>
              <p>${escapeHtml(guide.heroSummary || '')}</p>
              <div class="directory-tag-wrap">
                ${tags.map((tag) => `<span class="directory-taxonomy-tag">${escapeHtml(tag)}</span>`).join('')}
              </div>
              <p class="guide-aliases">Aliases: ${escapeHtml(aliases || 'No common aliases listed')}</p>
              <div class="directory-card-actions">
                <a class="btn btn-outline" href="guides/${escapeHtml(guide.slug)}.html">Open guide</a>
              </div>
            </article>
          `;
        }).join('');
      };

      const updateFacetButtons = () => {
        facetChips.forEach((chip) => {
          const facet = chip.dataset.facet;
          const value = chip.dataset.value;
          chip.classList.toggle('active', state.selected[facet].has(value));
        });
      };

      const rerender = () => {
        syncUrl();
        updateFacetButtons();
        renderActiveFilters();
        renderGuides();
      };

      searchInput.addEventListener('input', (event) => {
        releaseDefaultPeptideSeed('q', '');
        state.q = normalize(event.target.value);
        rerender();
      });

      facetChips.forEach((chip) => {
        chip.addEventListener('click', () => {
          const facet = chip.dataset.facet;
          const value = chip.dataset.value;
          releaseDefaultPeptideSeed(facet, value);
          if (state.selected[facet].has(value)) {
            state.selected[facet].delete(value);
          } else {
            state.selected[facet].add(value);
          }
          rerender();
        });
      });

      activeFiltersEl.addEventListener('click', (event) => {
        const button = event.target.closest('button[data-remove]');
        if (!button) return;

        const facet = button.dataset.remove;

        if (facet === 'q') {
          state.q = '';
          searchInput.value = '';
        } else {
          state.selected[facet].delete(button.dataset.value);
        }

        rerender();
      });

      clearFiltersButton.addEventListener('click', () => {
        state.q = '';
        searchInput.value = '';
        FACET_KEYS.forEach((facet) => state.selected[facet].clear());
        defaultPeptideSeed.active = false;
        rerender();
      });

      restoreStateFromUrl();
      searchInput.value = state.q;

      fetch('content/guides.json', { cache: 'no-store' })
        .then((res) => res.json())
        .then((guideData) => {
          guides = guideData
            .map((guide) => ({ ...guide, searchIndex: buildSearchIndex(guide) }))
            .sort((a, b) => (a.displayTitle || a.title).localeCompare(b.displayTitle || b.title));

          updateFacetButtons();
          renderActiveFilters();
          renderGuides();
        })
        .catch((error) => {
          console.error(error);
          meta.textContent = 'Unable to load guide data. Please refresh or contact support.';
          grid.innerHTML = '<article class="directory-card"><h3>Directory unavailable</h3><p>Guide data could not be loaded right now.</p></article>';
        });
    }());
  </script>
</body>
</html>
